<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agentic Platform Simulation Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .game-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .sidebar {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .stats-grid {
            display: grid;
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
        }

        .maturity-section {
            margin-top: 25px;
        }

        .maturity-section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .maturity-bar {
            margin-bottom: 15px;
        }

        .maturity-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .progress-bar {
            height: 25px;
            background: #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-size: 0.85em;
            font-weight: bold;
        }

        .main-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .welcome-screen {
            text-align: center;
            padding: 60px 20px;
        }

        .welcome-screen h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .welcome-screen p {
            color: #666;
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(102, 126, 234, 0.6);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .decisions-container {
            display: grid;
            gap: 20px;
        }

        .decision-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }

        .decision-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .decision-title {
            color: #667eea;
            font-size: 1.4em;
            margin-bottom: 10px;
        }

        .decision-description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .decision-options {
            display: grid;
            gap: 15px;
        }

        .option-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option-card:hover {
            background: #e3f2fd;
            border-color: #667eea;
        }

        .option-card.selected {
            background: #e8eaf6;
            border-color: #667eea;
        }

        .option-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .option-costs {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .cost-item {
            background: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            color: #666;
        }

        .option-impacts {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }

        .impact-grid {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .impact-badge {
            background: #667eea;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
        }

        .impact-badge.positive {
            background: #4caf50;
        }

        .impact-badge.negative {
            background: #f44336;
        }

        .events-section {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .event-card {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .event-card.critical {
            background: #f8d7da;
            border-left-color: #dc3545;
        }

        .event-week {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 5px;
        }

        .event-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-success {
            background: #28a745;
        }

        .final-report {
            padding: 30px;
        }

        .report-section {
            margin-bottom: 30px;
        }

        .report-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .grade-display {
            font-size: 4em;
            font-weight: bold;
            text-align: center;
            color: #667eea;
            margin: 20px 0;
        }

        .score-display {
            text-align: center;
            font-size: 1.5em;
            color: #666;
            margin-bottom: 30px;
        }

        .list-item {
            background: #f8f9fa;
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 5px;
            border-left: 3px solid #667eea;
        }

        .hidden {
            display: none;
        }

        .upload-status {
            margin-top: 25px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 1em;
        }

        .upload-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .upload-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .upload-status.loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        @media (max-width: 1024px) {
            .game-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 AI Platform Strategy</h1>
            <p>Strategic simulation for building enterprise AI platforms</p>
        </div>

        <div id="welcomeScreen" class="main-content welcome-screen">
            <h2>AI Platform Strategy Game</h2>
            <p>Build a production-ready multi-agent platform. Make strategic decisions to balance budget, security, and performance.</p>
            
            <div class="action-buttons" style="justify-content: center; margin-top: 40px;">
                <button class="btn" onclick="startNewGame()">Start Game</button>
                <button class="btn btn-secondary" onclick="document.getElementById('pdfInput').click()">
                    📄 Upload PDF Scenario
                </button>
            </div>
            
            <input type="file" id="pdfInput" accept=".pdf" style="display: none;" onchange="uploadPDF(event)">
            
            <div id="uploadStatus" class="upload-status hidden"></div>
        </div>

        <div id="gameScreen" class="hidden">
            <div class="game-container">
                <div class="sidebar">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div>
                                <div class="stat-label">Budget</div>
                                <div class="stat-value" id="budget">$0</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div>
                                <div class="stat-label">Weeks Remaining</div>
                                <div class="stat-value" id="timeRemaining">0</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div>
                                <div class="stat-label">Resources</div>
                                <div class="stat-value" id="resources">0</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div>
                                <div class="stat-label">Current Week</div>
                                <div class="stat-value" id="currentWeek">0</div>
                            </div>
                        </div>
                    </div>

                    <div class="maturity-section">
                        <h3>Maturity Levels</h3>
                        <div class="maturity-bar">
                            <div class="maturity-label">
                                <span>Agent Development</span>
                                <span id="maturityDev">0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressDev" style="width: 0%">0%</div>
                            </div>
                        </div>
                        <div class="maturity-bar">
                            <div class="maturity-label">
                                <span>Agent Operations</span>
                                <span id="maturityOps">0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressOps" style="width: 0%">0%</div>
                            </div>
                        </div>
                        <div class="maturity-bar">
                            <div class="maturity-label">
                                <span>Data Platforms</span>
                                <span id="maturityData">0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressData" style="width: 0%">0%</div>
                            </div>
                        </div>
                        <div class="maturity-bar">
                            <div class="maturity-label">
                                <span>Security</span>
                                <span id="maturitySec">0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressSec" style="width: 0%">0%</div>
                            </div>
                        </div>
                        <div class="maturity-bar">
                            <div class="maturity-label">
                                <span>Governance</span>
                                <span id="maturityGov">0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressGov" style="width: 0%">0%</div>
                            </div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-success" onclick="launchProduction()" id="launchBtn">
                            🚀 Launch
                        </button>
                        <button class="btn btn-danger" onclick="endGame()" id="endBtn">
                            End
                        </button>
                    </div>
                </div>

                <div class="main-content">
                    <div id="decisionsArea">
                        <h2>Strategic Decisions</h2>
                        <div id="loadingDecisions" class="loading hidden">
                            <div class="spinner"></div>
                            <p>Loading...</p>
                        </div>
                        <div id="decisionsContainer" class="decisions-container"></div>
                    </div>

                    <div id="eventsArea" class="events-section hidden">
                        <h3>Activity Log</h3>
                        <div id="eventsContainer"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="reportScreen" class="main-content hidden">
            <div class="final-report">
                <h2 style="text-align: center; color: #667eea; margin-bottom: 30px;">Final Report</h2>
                <div id="reportContent"></div>
                <div style="text-align: center; margin-top: 40px;">
                    <button class="btn" onclick="location.reload()">New Game</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentGameState = null;
        let currentDecisions = [];
        let selectedOption = null;

        async function uploadPDF(event) {
            const file = event.target.files[0];
            if (!file) return;

            const statusDiv = document.getElementById('uploadStatus');
            statusDiv.className = 'upload-status loading';
            statusDiv.textContent = 'Uploading and processing PDF...';
            statusDiv.classList.remove('hidden');

            const formData = new FormData();
            formData.append('pdf_file', file);

            try {
                const response = await fetch('/api/scenarios/add-from-pdf', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    statusDiv.className = 'upload-status success';
                    statusDiv.textContent = `✓ Success! Added ${data.scenarios_added} scenarios from PDF`;
                    
                    // Reset file input
                    event.target.value = '';
                    
                    // Hide status after 5 seconds
                    setTimeout(() => {
                        statusDiv.classList.add('hidden');
                    }, 5000);
                } else {
                    statusDiv.className = 'upload-status error';
                    statusDiv.textContent = `✗ Error: ${data.error}`;
                }
            } catch (error) {
                console.error('Upload error:', error);
                statusDiv.className = 'upload-status error';
                statusDiv.textContent = '✗ Upload failed. Please try again.';
            }
        }

        async function startNewGame() {
            try {
                const response = await fetch('/api/game/new', {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (data.success) {
                    currentGameState = data.game_state;
                    document.getElementById('welcomeScreen').classList.add('hidden');
                    document.getElementById('gameScreen').classList.remove('hidden');
                    updateUI();
                    loadDecisions();
                }
            } catch (error) {
                console.error('Error starting game:', error);
                alert('Error starting game. Please check console.');
            }
        }

        function updateUI() {
            if (!currentGameState) return;

            document.getElementById('budget').textContent = 
                `$${currentGameState.budget.toLocaleString()}`;
            document.getElementById('timeRemaining').textContent = 
                currentGameState.time_remaining_weeks;
            document.getElementById('resources').textContent = 
                currentGameState.resources;
            document.getElementById('currentWeek').textContent = 
                currentGameState.current_week;

            updateMaturity('Dev', currentGameState.maturity.agent_development);
            updateMaturity('Ops', currentGameState.maturity.agent_operations);
            updateMaturity('Data', currentGameState.maturity.data_platforms);
            updateMaturity('Sec', currentGameState.maturity.security);
            updateMaturity('Gov', currentGameState.maturity.governance);

            updateEvents();
        }

        function updateMaturity(suffix, value) {
            document.getElementById(`maturity${suffix}`).textContent = value;
            const progressFill = document.getElementById(`progress${suffix}`);
            progressFill.style.width = `${value}%`;
            progressFill.textContent = `${value}%`;
        }

        function updateEvents() {
            const eventsContainer = document.getElementById('eventsContainer');
            const eventsArea = document.getElementById('eventsArea');
            
            if (currentGameState.events.length > 0) {
                eventsArea.classList.remove('hidden');
                eventsContainer.innerHTML = currentGameState.events
                    .slice(-5)
                    .reverse()
                    .map(event => `
                        <div class="event-card ${event.title.includes('Critical') ? 'critical' : ''}">
                            <div class="event-week">Week ${event.week}</div>
                            <div class="event-title">${event.title}</div>
                            <div>${event.description}</div>
                        </div>
                    `).join('');
            }
        }

        async function loadDecisions() {
            const loadingDiv = document.getElementById('loadingDecisions');
            const container = document.getElementById('decisionsContainer');
            
            loadingDiv.classList.remove('hidden');
            container.innerHTML = '';

            try {
                const response = await fetch('/api/decisions/available');
                const data = await response.json();
                
                if (data.success && data.decisions.length > 0) {
                    currentDecisions = data.decisions;
                    displayDecisions(data.decisions);
                } else {
                    container.innerHTML = '<p>No decisions available. Click "Launch" when ready.</p>';
                }
            } catch (error) {
                console.error('Error loading decisions:', error);
                container.innerHTML = '<p>Error loading decisions. Please try again.</p>';
            } finally {
                loadingDiv.classList.add('hidden');
            }
        }

        function displayDecisions(decisions) {
            const container = document.getElementById('decisionsContainer');
            container.innerHTML = decisions.map((decision, decisionIndex) => `
                <div class="decision-card">
                    <h3 class="decision-title">${decision.title}</h3>
                    <p class="decision-description">${decision.description}</p>
                    <div class="decision-options">
                        ${decision.options.map((option, optionIndex) => `
                            <div class="option-card" onclick="selectOption(${decisionIndex}, ${optionIndex})">
                                <div class="option-title">${option.text}</div>
                                <div class="option-costs">
                                    <span class="cost-item">💰 $${option.cost.toLocaleString()}</span>
                                    <span class="cost-item">⏱️ ${option.time_weeks} weeks</span>
                                    <span class="cost-item">👥 ${option.resources_required} resources</span>
                                </div>
                                <div class="option-impacts">
                                    <strong>Impact:</strong>
                                    <div class="impact-grid">
                                        ${Object.entries(option.maturity_impact || {})
                                            .filter(([_, value]) => value !== 0)
                                            .map(([key, value]) => `
                                                <span class="impact-badge ${value > 0 ? 'positive' : 'negative'}">
                                                    ${key.replace('_', ' ')}: ${value > 0 ? '+' : ''}${value}
                                                </span>
                                            `).join('')}
                                    </div>
                                </div>
                                ${option.consequences ? `<p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                                    ${option.consequences}
                                </p>` : ''}
                            </div>
                        `).join('')}
                    </div>
                    <button class="btn" style="margin-top: 15px;" 
                            onclick="confirmDecision(${decisionIndex})" 
                            id="confirmBtn${decisionIndex}" disabled>
                        Confirm
                    </button>
                </div>
            `).join('');
        }

        function selectOption(decisionIndex, optionIndex) {
            // Remove previous selection
            document.querySelectorAll('.option-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Add selection to clicked option
            event.currentTarget.classList.add('selected');
            selectedOption = {
                decisionIndex,
                optionIndex,
                option: currentDecisions[decisionIndex].options[optionIndex]
            };

            // Enable confirm button
            document.getElementById(`confirmBtn${decisionIndex}`).disabled = false;
        }

        async function confirmDecision(decisionIndex) {
            if (!selectedOption || selectedOption.decisionIndex !== decisionIndex) {
                alert('Please select an option first');
                return;
            }

            try {
                const response = await fetch('/api/decision/make', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ option: selectedOption.option })
                });

                const data = await response.json();
                
                if (data.success) {
                    currentGameState = data.new_state;
                    selectedOption = null;
                    updateUI();
                    loadDecisions();
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error making decision:', error);
                alert('Error making decision. Please try again.');
            }
        }

        async function launchProduction() {
            if (!confirm('Launch to production? This cannot be undone.')) {
                return;
            }

            try {
                const response = await fetch('/api/production/launch', {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (data.success) {
                    alert(`✓ Launched!\nRisk: ${data.analysis.risk_level.toUpperCase()}\nIssues: ${data.production_issues.length}`);
                    
                    // Refresh game state
                    const stateResponse = await fetch('/api/game/state');
                    const stateData = await stateResponse.json();
                    currentGameState = stateData.game_state;
                    updateUI();
                    
                    // Disable launch button
                    document.getElementById('launchBtn').disabled = true;
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error launching production:', error);
                alert('Error launching production. Please try again.');
            }
        }

        async function endGame() {
            if (!confirm('End game now?')) {
                return;
            }

            try {
                const response = await fetch('/api/game/end', {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (data.success) {
                    displayFinalReport(data.result);
                }
            } catch (error) {
                console.error('Error ending game:', error);
                alert('Error ending game. Please try again.');
            }
        }

        function displayFinalReport(result) {
            const report = result.report;
            const state = result.game_state;

            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('reportScreen').classList.remove('hidden');

            const content = document.getElementById('reportContent');
            content.innerHTML = `
                <div class="grade-display">${report.grade}</div>
                <div class="score-display">Overall Score: ${report.overall_score}/100</div>

                <div class="report-section">
                    <h3>Summary</h3>
                    <p style="font-size: 1.1em; line-height: 1.6;">${report.summary}</p>
                </div>

                <div class="report-section">
                    <h3>Strengths</h3>
                    ${report.strengths.map(s => `<div class="list-item">✓ ${s}</div>`).join('')}
                </div>

                <div class="report-section">
                    <h3>Weaknesses</h3>
                    ${report.weaknesses.map(w => `<div class="list-item">⚠️ ${w}</div>`).join('')}
                </div>

                <div class="report-section">
                    <h3>Key Learnings</h3>
                    ${report.key_learnings.map(l => `<div class="list-item">💡 ${l}</div>`).join('')}
                </div>

                <div class="report-section">
                    <h3>Prescriptive Guidance</h3>
                    <h4 style="color: #667eea; margin: 15px 0 10px 0;">Short-term Actions</h4>
                    ${report.prescriptive_guidance.short_term.map(a => `<div class="list-item">🎯 ${a}</div>`).join('')}
                    
                    <h4 style="color: #667eea; margin: 15px 0 10px 0;">Medium-term Actions</h4>
                    ${report.prescriptive_guidance.medium_term.map(a => `<div class="list-item">📈 ${a}</div>`).join('')}
                    
                    <h4 style="color: #667eea; margin: 15px 0 10px 0;">Long-term Strategic Initiatives</h4>
                    ${report.prescriptive_guidance.long_term.map(a => `<div class="list-item">🚀 ${a}</div>`).join('')}
                </div>

                <div class="report-section">
                    <h3>Best Practices for Multi-Agent Platforms</h3>
                    ${report.best_practices.map(bp => `<div class="list-item">⭐ ${bp}</div>`).join('')}
                </div>

                <div class="report-section">
                    <h3>Recommendations</h3>
                    ${report.recommendations.map(r => `<div class="list-item">💼 ${r}</div>`).join('')}
                </div>
            `;
        }
    </script>
</body>
</html>
